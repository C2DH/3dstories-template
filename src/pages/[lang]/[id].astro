---
import Layout from "../../layouts/Layout.astro";
import App from "../../components/App.astro";
import { AstroSeo } from '@astrolib/seo';
import { AvailableLanguages, CanonicalUrl } from "../../constants";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const stories = await getCollection('stories');
	return AvailableLanguages.map(lang => stories.map(story => ({
		params: { id: story.id, lang }, props: { story }
	}))).flat();
}

const { story } = Astro.props;
const title = `${story.data.title[Astro.params.lang]} - 3D Stories Template`;
const description =  story.data.excerpt[Astro.params.lang]

---

<Layout 
	title={title}
	description={description}
>
<AstroSeo
	title={title}
	description={description}
	canonical={CanonicalUrl}
/>
	<App transition:persist />
</Layout>
<noscript>
	<h1>{story.data.title[Astro.params.lang]}</h1>
	<div>{story.data.content[Astro.params.lang]}</div>
	{story.data.sections.map((section) => (
		<section>
			<h2>{section.title[Astro.params.lang]}</h2>
			<div>{section.content[Astro.params.lang]}</div>
		</section>
	))}
	{story.data.footer && (
		<footer>
			<h3>{story.data.footer.title[Astro.params.lang]}</h3>
			<div>{story.data.footer.content[Astro.params.lang]}</div>
		</footer>
	)}
</noscript>