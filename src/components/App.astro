---
import { getCollection } from "astro:content";
import { AvailableLanguages, Basename, DefaultLanguage } from "../constants";
import AppComponent from "./App";
import type { StorySectionToCItem, StoryToCItem } from "../types";
// get all stories
const stories = await getCollection('stories');
// get current language 
const lang:string  = (Astro.currentLocale || DefaultLanguage)

const TableOfContents:StoryToCItem[] = stories.map((story) => ({
  id: story.id,
  title: story.data.title[lang],
  duration: story.data.duration || 10,
  ordering: story.data.ordering || stories.length,
  sections: story.data.sections.map((section, idx:number) => ({
    id: `${story.id}-${idx}`,
    title: section.title[lang as string],
  })) as StorySectionToCItem[],
  settings: story.data.settings
})).sort((a:StoryToCItem, b:StoryToCItem) => a.ordering - b.ordering);

---

<AppComponent
  client:only 
  basename={Basename} 
  lang={lang} 
  availableLanguages={AvailableLanguages as string[]} 
  tableOfContents={TableOfContents}
/>


